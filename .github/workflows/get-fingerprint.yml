name: Get SHA-1 Fingerprint

on:
  workflow_dispatch:

jobs:
  get_fingerprint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: Decode Keystore and Get Fingerprint
        env:
          KEYSTORE_B64: ${{ secrets.KEYSTORE_B64 }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: |
          echo "Decoding keystore..."
          # Clean the secret, removing all non-base64 characters, then decode
          echo "$KEYSTORE_B64" | tr -cd 'A-Za-z0-9+/=' | base64 --decode > my-release-key.keystore
          echo "Keystore decoded. Extracting SHA-1 fingerprint..."
          FINGERPRINT=$(keytool -list -v -keystore my-release-key.keystore -alias "$KEY_ALIAS" -storepass "$KEY_PASSWORD")
          echo "::notice title=SHA-1 Fingerprint::$(echo "$FINGERPRINT" | grep "SHA1:")"
